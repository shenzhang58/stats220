---
title: "YouTube Audience Analysis: Weekly Patterns and Age Group Differences"
output: html_document
---

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, error=FALSE)
 
library(tidyverse)
library(lubridate)
library(stringr)

Sys.setlocale("LC_TIME", "C")

# Read data directly from URL
logged_data <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRLC3mYiPP8jW2eC5gguMFMt4I05cYwY586jb1-bSU6bXV_cFd6J1XiIe1VY3kns27b7_LDNnLNr_Cc/pub?output=csv")

latest_data <- logged_data %>%
  rename(
    Timestamp = 1,
    watch_time = 2,
    age_group = 3,
    enter_views = 4
  )



# Data manipulation 1:Weekday calculation
latest_data <- latest_data %>%
  mutate(
    Timestamp = dmy_hms(Timestamp),
    date = as_date(Timestamp),
    weekday = wday(date, label = TRUE, week_start = 1),  # Get abbreviated weekday names
    age_group = str_replace(age_group, " years.*", "") %>%
      str_replace("Under ", "<") %>%
      str_replace("â€“", "-")
  ) %>%
  arrange(Timestamp)  %>%  # Reverse chronological order
  slice(1:42)  # Keep first 42 records

glimpse(latest_data)

# Data manipulation 2: Weekday calculation and daily summary
daily_weekday_summary <- latest_data %>%
  group_by(weekday) %>%
  summarise(
    total_watch_weekday = sum(watch_time),
    total_views_weekday = sum(enter_views),
    ave_week_duration_second = round( total_watch_weekday*3600/total_views_weekday ,2),
    
    .groups = "drop"
  ) %>%
  mutate(
    day_type = ifelse(weekday %in% c("Sat", "Sun"), "Weekend", "Weekday")  # create day_type
  ) %>%
  # Ensure proper weekday ordering
  arrange(weekday) %>%
  # Format numbers for readability
  mutate(across(where(is.numeric), ~ round(., 2)))

glimpse(daily_weekday_summary)

# Data manipulation 3: Create age group summary (modified group_by)
age_summary <- latest_data %>%
  group_by(age_group) %>%  # Changed grouping variable to age_group
  summarise(
    total_watch_group = sum(watch_time),
    total_views_group = sum(enter_views),
    ave_group_duration_second = round( total_watch_group*3600/total_views_group ,2),
    .groups = "drop"
  ) %>%
  arrange(desc(ave_group_duration_second))  # Order by descending watch time

 

glimpse(age_summary)
 



# Color palette (ColorBrewer Set2)
cb_palette <- c("#66c2a5", "#fc8d62", "#8da0cb", 
                "#e78ac3", "#a6d854", "#ffd92f")

# Plot 1: Weekday Viewing Patterns (Line Plot)
plot1 <- ggplot(daily_weekday_summary, 
                aes(x = weekday, y = total_watch_weekday, group = 1)) +
  geom_line(color = cb_palette[1], linewidth = 1) +
  geom_point(aes(color = day_type), size = 4) +   
  scale_color_manual(values = cb_palette[4:5]) +
  labs(title = "Plot 1: Weekday Viewing Patterns (Line Plot)",
       x = "Weekday",
       y = "Total Watch Time (hours)",
       color = "Day Type") +
  theme_minimal()

ggsave("plot1.png", plot1, width = 10, height = 6)

# Plot 2: Age Group Duration Comparison (Bar Plot)
plot2 <- ggplot(age_summary, 
                aes(x = fct_reorder(age_group, total_watch_group), 
                    y = total_watch_group)) +
  geom_col(fill = cb_palette[1]) +
  coord_flip() +
  labs(title = "Plot 2: Age Group Duration Comparison (Bar Plot)",
       x = "Age Category",
       y = "Total Watch Time (hours)") +
  theme_minimal()

ggsave("plot2.png", plot2, width = 9, height = 7)

# PLOT 3: COMBINED WEEKLY & AGE GROUP ANALYSIS  
plot3 <- bind_rows(
  # Weekly patterns data
  daily_weekday_summary %>%
    select(category = weekday, value = ave_week_duration_second) %>%
    mutate(type = "Weekly Patterns"),
  
  # Age group data
  age_summary %>%
    select(category = age_group, value = ave_group_duration_second) %>%
    mutate(type = "Age Groups")
) %>%
  ggplot(aes(x = category, y = value, fill = type)) +
  
  # Dual geom layers
  geom_col(position = "dodge", width = 0.7) +
  geom_text(
    aes(label = round(value)),
    position = position_dodge(width = 0.7),
    vjust = -0.5,
    size = 3
  ) +
  
  # Coordinate system
  coord_flip() +
  
  # Axis formatting
  scale_y_continuous(
    name = "Average Duration (seconds)",
    labels = scales::comma
  ) +
  
  # Visual styling
  scale_fill_manual(values = cb_palette[c(4,1)]) +
  labs(
    title = "PLOT 3: COMBINED WEEKLY & AGE GROUP ANALYSIS  ",
    x = "Category",
    fill = "Analysis Type"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    legend.position = "top"
  )

ggsave("plot3.png", plot3, width = 12, height = 8, dpi = 300)

 
```


```{js}
$(function() {
  $(".level2").css('visibility', 'hidden');
  $(".level2").first().css('visibility', 'visible');
  $(".container-fluid").height($(".container-fluid").height() + 300);
  $(window).on('scroll', function() {
    $('h2').each(function() {
      var h2Top = $(this).offset().top - $(window).scrollTop();
      var windowHeight = $(window).height();
      if (h2Top >= 0 && h2Top <= windowHeight / 2) {
        $(this).parent('div').css('visibility', 'visible');
      } else if (h2Top > windowHeight / 2) {
        $(this).parent('div').css('visibility', 'hidden');
      }
    });
  });
})
```

```{css}
.figcaption {display: none}
```




## Introduction

Our dataset contains `r nrow(latest_data)` viewing records collected between `r format(min(latest_data$date), "%B %d")` and `r format(max(latest_data$date), "%B %d")`. The analysis focuses on two key metrics:
Weekly Patterns and Age Group Differences

### Understanding Viewer Engagement Patterns

![plot1](plot1.png)
 

 - **Lowest engagement** happens on **`r daily_weekday_summary$weekday[which.min(daily_weekday_summary$total_watch_weekday)]`** 
  with `r min(daily_weekday_summary$total_watch_weekday)` total watch hours
  
- **Peak viewership** occurs on **`r daily_weekday_summary$weekday[which.max(daily_weekday_summary$total_watch_weekday)]`** 
  with `r max(daily_weekday_summary$total_watch_weekday)` total watch hours


### Age Group Viewing Behavior

![plot2](plot2.png)

- **Lowest viewership**: `r age_summary$age_group[which.min(age_summary$total_watch_group)]` group  
  (`r round(min(age_summary$total_watch_group), 1)` total hours)
  
- **Highest viewership**: `r age_summary$age_group[which.max(age_summary$total_watch_group)]` group  
  (`r round(max(age_summary$total_watch_group), 1)` total hours)

 
 
### Duration Analysis: Weekly Patterns vs Age Groups

![plot3](plot3.png)

 
### Combined Viewing Pattern Analysis

Key insights from `r nrow(bind_rows(daily_weekday_summary, age_summary))` analyzed categories:

- **Peak weekly engagement**: `r daily_weekday_summary$weekday[which.max(daily_weekday_summary$ave_week_duration_second)]`  
  (`r round(max(daily_weekday_summary$ave_week_duration_second), 1)` seconds average)

- **Highest age group duration**: `r age_summary$age_group[which.max(age_summary$ave_group_duration_second)]`  
  (`r round(max(age_summary$ave_group_duration_second), 1)` seconds per view)

- **Lowest age group duration**: `r age_summary$age_group[which.min(age_summary$ave_group_duration_second)]`  
  (`r round(min(age_summary$ave_group_duration_second), 1)` seconds per view)  

